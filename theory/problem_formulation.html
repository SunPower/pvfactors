<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mathematical Model &mdash; pvfactors 1.5.1+0.g3c619d3.dirty documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer API" href="../developer/index.html" />
    <link rel="prev" title="View Factors" href="view_factors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pvfactors
            <img src="../_static/logo_small.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Main concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Theory</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="view_factors.html">View Factors</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mathematical Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#full-simulations">Full simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fast-simulations">Fast simulations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grouping-terms">Grouping terms</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s New</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pvfactors</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Theory</a> &raquo;</li>
      <li>Mathematical Model</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/SunPower/pvfactors/" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="mathematical-model">
<span id="problem-formulation"></span><h1>Mathematical Model<a class="headerlink" href="#mathematical-model" title="Permalink to this headline"></a></h1>
<p>In order to use the view factors as follows, we need to assume that the surfaces considered are diffuse (lambertian). Which means that their optical properties are independent of the angle of the rays (incident, reflected, or emitted).</p>
<p>The current version of the view factor model only addresses PV rows that are made out of straight lines
(no “dual-tilt” for instance), with a flat ground. But the PV array can have any azimuth or tilt angle for the simulations. Below is the 2D representation of such a PV array, plotted with <code class="docutils literal notranslate"><span class="pre">pvfactors</span></code>.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/pvarray.png"><img alt="../_images/pvarray.png" src="../_images/pvarray.png" style="width: 80%;" /></a>
</figure>
<p>The mathematical model used in <code class="docutils literal notranslate"><span class="pre">pvfactors</span></code> simulations is different depending on the simulation type
that is run.</p>
<ul class="simple">
<li><p>in “full simulations”, all of the reflections between the modeled surfaces are taken into account in the calculations, which leads to results that account for the equilibrium of reflections between surfaces.</p></li>
<li><p>in “fast simulations”, assumptions are made on the reflected irradiance from the environment surrounding the surfaces of interest.</p></li>
</ul>
<section id="full-simulations">
<span id="full-mode-theory"></span><h2>Full simulations<a class="headerlink" href="#full-simulations" title="Permalink to this headline"></a></h2>
<p>When making some assumptions, it is possible to represent the calculation of irradiance terms on each surface with a linear system. The dimension of this system changes depending on the number of surfaces considered. But we can formulate it for the general case of <code class="docutils literal notranslate"><span class="pre">n</span></code> surfaces.</p>
<p>For a surface <code class="docutils literal notranslate"><span class="pre">i</span></code> we can write that:</p>
<div class="math notranslate nohighlight">
\[q_{o, i} = q_{emitted, i} + q_{reflected, i}\]</div>
<p>Unit: <span class="math notranslate nohighlight">\(W/m^2\)</span>.</p>
<div class="line-block">
<div class="line">* <span class="math notranslate nohighlight">\(q_{o, i}\)</span> is the radiosity of surface <code class="docutils literal notranslate"><span class="pre">i</span></code>, and it represents the outgoing radiative flux from it.</div>
<div class="line">* <span class="math notranslate nohighlight">\(q_{emitted, i}\)</span> is the emitted radiative flux from that surface. For instance the total emitted radiative flux of a blackbody is known to be <span class="math notranslate nohighlight">\({\sigma}T^4\)</span> (with <span class="math notranslate nohighlight">\(T\)</span> the surface temperature and <span class="math notranslate nohighlight">\({\sigma}\)</span> the Stefan–Boltzmann constant).</div>
<div class="line">* <span class="math notranslate nohighlight">\(q_{reflected, i}\)</span> is the reflected flux from that surface.</div>
</div>
<p>Finding values of interest like back side irradiance can only be done after finding the
radiosity <span class="math notranslate nohighlight">\(q_{o, i}\)</span> of each surface <code class="docutils literal notranslate"><span class="pre">i</span></code>. This can become a very complex system of equations where one would need to solve the energy balance on the considered systems .</p>
<div class="line-block">
<div class="line">But if we decide to make the assumption that <span class="math notranslate nohighlight">\(q_{emitted, i}\)</span> is negligible, we can simplify the problem in a way that would enable us to find more easily some approximations of the values of interest. For now, this assumption makes some sense because the temperatures of the PV systems and the surroundings are generally not very high (&lt; 330K). Besides the surfaces are not real black bodies, which means that their total (or broadband) emissions and absorptions will be even lower.</div>
<div class="line">Under this assumption, we end up with:</div>
</div>
<div class="math notranslate nohighlight">
\[q_{o, i}{\;}{\approx}{\;}q_{reflected, i}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[q_{reflected, i} = {\rho_i} * q_{incident, i}\]</div>
<div class="line-block">
<div class="line">with:</div>
<div class="line">* <span class="math notranslate nohighlight">\(q_{incident, i}\)</span> is the incident radiative flux on surface <code class="docutils literal notranslate"><span class="pre">i</span></code>.</div>
<div class="line">* <span class="math notranslate nohighlight">\({\rho_i}\)</span> is the total reflectivity of surface <code class="docutils literal notranslate"><span class="pre">i</span></code>.</div>
</div>
<p>We can further develop this expression and involve configuration factors as well as irradiance terms as follows:</p>
<div class="math notranslate nohighlight">
\[q_{reflected, i} = {\rho_i} * ({\sum_{j} q_{o, j} * F_{i, j}} + Sky_i)\]</div>
<div class="line-block">
<div class="line">where:</div>
<div class="line">* <span class="math notranslate nohighlight">\({\sum_{j} q_{o, j} * F_{i, j}}\)</span> is the contribution of all the surfaces <code class="docutils literal notranslate"><span class="pre">j</span></code> surrounding <code class="docutils literal notranslate"><span class="pre">i</span></code> to the incident radiative flux onto surface <code class="docutils literal notranslate"><span class="pre">i</span></code>.</div>
<div class="line">* <span class="math notranslate nohighlight">\(F_{i, j}\)</span> is the configuration factor (or view factor) of surface <code class="docutils literal notranslate"><span class="pre">i</span></code> to surface <code class="docutils literal notranslate"><span class="pre">j</span></code>.</div>
<div class="line">* <span class="math notranslate nohighlight">\(Sky_i\)</span> is a sky irradiance term specific to surface <code class="docutils literal notranslate"><span class="pre">i</span></code> which contributes to the incident radiative flux  <span class="math notranslate nohighlight">\(q_{incident, i}\)</span>, and associated with irradiance terms not represented in the geometrical model. For instance, it will be equal to <span class="math notranslate nohighlight">\(DNI_{POA} + circumsolar_{POA} + horizon_{POA}\)</span> for the front (illuminated) side of the modules, when using the <a class="reference internal" href="../developer/generated/pvfactors.irradiance.models.HybridPerezOrdered.html#pvfactors.irradiance.models.HybridPerezOrdered" title="pvfactors.irradiance.models.HybridPerezOrdered"><code class="xref py py-class docutils literal notranslate"><span class="pre">HybridPerezOrdered</span></code></a> model.</div>
</div>
<p>This results into a linear system that can be written as follows:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\mathbf{q_o} = \mathbf{R} . (\mathbf{F} . \mathbf{q_o} + \mathbf{Sky})\\(\mathbf{R}^{-1} - \mathbf{F}).\mathbf{q_o} = \mathbf{Sky}\end{aligned}\end{align} \]</div>
<p>Or, for a system of <code class="docutils literal notranslate"><span class="pre">n</span></code> surfaces:</p>
<div class="math notranslate nohighlight">
\[\begin{split}(\begin{pmatrix}
{\rho_1}      &amp; 0             &amp; 0      &amp; \cdots   &amp; 0\\
0             &amp; {\rho_2}      &amp; 0      &amp; \cdots   &amp; 0\\
\vdots        &amp; \vdots        &amp; \vdots &amp; \ddots   &amp; \vdots\\
0             &amp; 0             &amp; 0      &amp; \cdots   &amp; {\rho_n}\\
\end{pmatrix}^{-1} -
\begin{pmatrix}
F_{1,1}      &amp; F_{1,2}      &amp; F_{1,3}      &amp; \cdots   &amp; F_{1,n}\\
F_{2,1}      &amp; F_{2,2}      &amp; F_{2,3}      &amp; \cdots   &amp; F_{2,n}\\
\vdots       &amp; \vdots       &amp; \vdots       &amp; \ddots   &amp; \vdots\\
F_{n,1}      &amp; F_{n,2}      &amp; F_{n,3}      &amp; \cdots   &amp; F_{n,n}\\
\end{pmatrix}).
\begin{pmatrix}
q_{o, 1}\\
q_{o, 2}\\
\vdots\\
q_{o, n}\\
\end{pmatrix}
=
\begin{pmatrix}
Sky_1\\
Sky_2\\
\vdots\\
Sky_n\\
\end{pmatrix}\end{split}\]</div>
<p>After solving this system and finding all of the radiosities, it is very easy to deduce values of interest like back side or front side incident irradiance.</p>
</section>
<section id="fast-simulations">
<span id="fast-mode-theory"></span><h2>Fast simulations<a class="headerlink" href="#fast-simulations" title="Permalink to this headline"></a></h2>
<p>In the case of fast simulations and when interested in back side surfaces only, we can make additional assumptions that allow us to calculate the incident irradiance on back side surfaces without solving a linear system of equations.</p>
<p>In the full simulation case, we defined a vector of incident irradiance on all surfaces as follows:</p>
<div class="math notranslate nohighlight">
\[\mathbf{q_{inc}} = \mathbf{F} . \mathbf{q_o} + \mathbf{Sky}\]</div>
<p>And we realized that we needed to solve for <span class="math notranslate nohighlight">\(\mathbf{q_o}\)</span> in order to find <span class="math notranslate nohighlight">\(\mathbf{q_{inc}}\)</span>. But with the following assumptions, we can find an approximation of <span class="math notranslate nohighlight">\(\mathbf{q_{inc}}\)</span> for back side surfaces without having to solve a linear system of equations:</p>
<ol class="arabic simple">
<li><p>we can assume that the radiosity of the surfaces is equal to their reflectivity multiplied by the incident irradiance on the surfaces as calculated by the Perez transposition model <a class="footnote-reference brackets" href="#perez-paper" id="id1">1</a>, which only works for front side surfaces. I.e.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\mathbf{q_{o}} ≈ \mathbf{R} . \mathbf{q_{perez}}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\mathbf{q_{perez}}\)</span> can have values equal to zero for back side surfaces, which will lead to a good assumption if the back side surfaces don’t see each other,
which is the case in <a class="reference internal" href="../developer/generated/pvfactors.geometry.pvarray.OrderedPVArray.html#pvfactors.geometry.pvarray.OrderedPVArray" title="pvfactors.geometry.pvarray.OrderedPVArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrderedPVArray</span></code></a>.</p>
<ol class="arabic simple" start="2">
<li><p>we can then also reduce the calculation of view factors to the view factors of the back side surfaces of interest, leading to the following:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\mathbf{q_{inc-back}} ≈ \mathbf{F_{back}} . \mathbf{R} . \mathbf{q_{perez}} + \mathbf{Sky_{back}}\]</div>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h3>
<p>For instance, if we are interested in back side surfaces with indices <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">7</span></code>, this will look like this:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
q_{inc, 3}\\
q_{inc, 7}\\
\end{pmatrix}
=
\begin{pmatrix}
F_{3,1}      &amp; F_{3,2}      &amp; F_{3,3}      &amp; \cdots   &amp; F_{3,n}\\
F_{7,1}      &amp; F_{7,2}      &amp; F_{7,3}      &amp; \cdots   &amp; F_{7,n}\\
\end{pmatrix} .
\begin{pmatrix}
{\rho_1}      &amp; 0             &amp; 0      &amp; \cdots   &amp; 0\\
0             &amp; {\rho_2}      &amp; 0      &amp; \cdots   &amp; 0\\
\vdots        &amp; \vdots        &amp; \vdots &amp; \ddots   &amp; \vdots\\
0             &amp; 0             &amp; 0      &amp; \cdots   &amp; {\rho_n}\\
\end{pmatrix} .
\begin{pmatrix}
q_{perez, 1}\\
q_{perez, 2}\\
\vdots\\
q_{perez, n}\\
\end{pmatrix}
+
\begin{pmatrix}
Sky_3\\
Sky_7\\
\end{pmatrix}\end{split}\]</div>
</section>
<section id="grouping-terms">
<h3>Grouping terms<a class="headerlink" href="#grouping-terms" title="Permalink to this headline"></a></h3>
<p>For each back surface element, we can then group reflection terms that have identical reflectivity
and <span class="math notranslate nohighlight">\(\mathbf{q_{perez}}\)</span> terms into something more intuitive:</p>
<div class="math notranslate nohighlight">
\[\begin{split}q_{inc-back}
&amp;≈ F_{to\ shaded\ ground} . albedo . q_{perez\ shaded\ ground} \\
&amp;+ F_{to\ illuminated\ ground} . albedo . q_{perez\ illuminated\ ground} \\
&amp;+ F_{to\ shaded\ front\ pv\ row} . \rho_{front\ pv\ row} . q_{perez\ front\ shaded\ pv\ row} \\
&amp;+ F_{to\ illuminated\ front\ pv\ row} . \rho_{front\ pv\ row} . q_{perez\ front\ shaded\ pv\ row} \\
&amp;+ F_{to\ sky\ dome} . luminance_{sky\ dome} \\
&amp;+ Sky_{inc-back}\end{split}\]</div>
<p>This form is quite useful because we can then rely on vectorization to calculate back surface incident irradiance quite rapidly.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="perez-paper"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Perez, R., Seals, R., Ineichen, P., Stewart, R. and Menicucci, D., 1987. A new simplified version of the Perez diffuse irradiance model for tilted surfaces. Solar energy, 39(3), pp.221-231.</p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="view_factors.html" class="btn btn-neutral float-left" title="View Factors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../developer/index.html" class="btn btn-neutral float-right" title="Developer API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, SunPower Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>